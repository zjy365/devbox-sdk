# Devbox Server API Tests
# ä½¿ç”¨ VS Code REST Client æ’ä»¶æˆ– IntelliJ HTTP Client
# æˆ–è€…ç”¨ Postman å¯¼å…¥

@baseUrl = http://localhost:3000

###############################################################################
# å¥åº·æ£€æŸ¥ Health Check
###############################################################################

### 1. åŸºç¡€å¥åº·æ£€æŸ¥
GET {{baseUrl}}/health

### 2. è¯¦ç»†å¥åº·ä¿¡æ¯
GET {{baseUrl}}/health/detailed

### 3. æœåŠ¡å™¨æŒ‡æ ‡
GET {{baseUrl}}/metrics

###############################################################################
# æ–‡ä»¶æ“ä½œ File Operations
###############################################################################

### 4b. åˆ›å»º workspace ç›®å½•ï¼ˆé€šè¿‡å†™å…¥å ä½æ–‡ä»¶è§¦å‘ç›®å½•åˆ›å»ºï¼‰
POST {{baseUrl}}/files/write
Content-Type: application/json

{
  "path": "/.keep",
  "content": "",
  "encoding": "utf8"
}

### 4. å†™å…¥æ–‡ä»¶ - UTF8
POST {{baseUrl}}/files/write 
Content-Type: application/json

{
  "path": "/test.txt",
  "content": "Hello Devbox Server! ğŸš€",
  "encoding": "utf8"
}

### 5. è¯»å–æ–‡ä»¶ - UTF8
POST {{baseUrl}}/files/read
Content-Type: application/json

{
  "path": "/test.txt",
  "encoding": "utf8"
}

### 6. å†™å…¥æ–‡ä»¶ - Base64
POST {{baseUrl}}/files/write
Content-Type: application/json

{
  "path": "/binary-test.bin",
  "content": "SGVsbG8gV29ybGQh",
  "encoding": "base64"
}

### 7. æ‰¹é‡ä¸Šä¼ æ–‡ä»¶
POST {{baseUrl}}/files/batch-upload
Content-Type: application/json

{
  "files": [
    {
      "path": "/file1.txt",
      "content": "Content 1",
      "encoding": "utf8"
    },
    {
      "path": "/file2.txt",
      "content": "Content 2",
      "encoding": "utf8"
    },
    {
      "path": "/file3.txt",
      "content": "Content 3",
      "encoding": "utf8"
    }
  ]
}

### 8. åˆ é™¤æ–‡ä»¶
POST {{baseUrl}}/files/delete
Content-Type: application/json

{
  "path": "/test.txt"
}

###############################################################################
# è¿›ç¨‹ç®¡ç† Process Management
###############################################################################

### 9. æ‰§è¡Œå‘½ä»¤ - Echo
POST {{baseUrl}}/process/exec
Content-Type: application/json

{
  "command": "echo",
  "args": ["Hello", "from", "Devbox"],
  "cwd": ""
}

### 10. æ‰§è¡Œå‘½ä»¤ - ls
POST {{baseUrl}}/process/exec
Content-Type: application/json

{
  "command": "ls",
  "args": ["-la"],
  "cwd": ""
}

### 11. æ‰§è¡Œå‘½ä»¤ - pwd
POST {{baseUrl}}/process/exec
Content-Type: application/json

{
  "command": "pwd",
  "cwd": ""
}

### 12. æ‰§è¡Œå‘½ä»¤ - å¸¦ç¯å¢ƒå˜é‡
POST {{baseUrl}}/process/exec
Content-Type: application/json

{
  "command": "env",
  "env": {
    "CUSTOM_VAR": "custom_value",
    "TEST_ENV": "test123"
  },
  "cwd": ""
}

### 13. åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹
GET {{baseUrl}}/process/list

### 14. æŸ¥è¯¢è¿›ç¨‹çŠ¶æ€ï¼ˆéœ€è¦æ›¿æ¢å®é™…çš„è¿›ç¨‹IDï¼‰
# å…ˆæ‰§è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œè·å– IDï¼Œç„¶åæ›¿æ¢ä¸‹é¢çš„ {processId}
GET {{baseUrl}}/process/status/proc_1234567890_abcdefg

### 15. è·å–è¿›ç¨‹æ—¥å¿—ï¼ˆéœ€è¦æ›¿æ¢å®é™…çš„è¿›ç¨‹IDï¼‰
GET {{baseUrl}}/process/logs/proc_1234567890_abcdefg?tail=100

### 16. ç»ˆæ­¢è¿›ç¨‹ï¼ˆéœ€è¦æ›¿æ¢å®é™…çš„è¿›ç¨‹IDï¼‰
POST {{baseUrl}}/process/kill
Content-Type: application/json

{
  "id": "proc_1234567890_abcdefg",
  "signal": "SIGTERM"
}

### 16b. æ‰§è¡Œå‘½ä»¤ä½†è¶…æ—¶ï¼ˆåº”è¿”å› failed/è¢«æ€æ­»ï¼‰
POST {{baseUrl}}/process/exec
Content-Type: application/json

{
  "command": "sleep",
  "args": ["5"],
  "cwd": "",
  "timeout": 1000
}

###############################################################################
# ä¼šè¯ç®¡ç† Session Management
###############################################################################

### 17. åˆ›å»ºä¼šè¯ - Bash
POST {{baseUrl}}/sessions/create
Content-Type: application/json

{
  "workingDir": "",
  "shell": "/bin/zsh",
  "env": {
    "SESSION_TYPE": "test",
    "USER_NAME": "devbox-user"
  }
}

### 18. åˆ›å»ºä¼šè¯ - Zsh
POST {{baseUrl}}/sessions/create
Content-Type: application/json

{
  "workingDir": "",
  "shell": "zsh"
}

### 19. åˆ—å‡ºæ‰€æœ‰ä¼šè¯
GET {{baseUrl}}/sessions

### 20. è·å–ä¼šè¯ä¿¡æ¯ï¼ˆéœ€è¦æ›¿æ¢å®é™…çš„ä¼šè¯IDï¼‰
# å…ˆåˆ›å»ºä¼šè¯ï¼Œè·å– IDï¼Œç„¶åæ›¿æ¢ä¸‹é¢çš„ {sessionId}
GET {{baseUrl}}/sessions/session_1234567890_abcdefg

### 21. åœ¨ä¼šè¯ä¸­æ‰§è¡Œå‘½ä»¤
POST {{baseUrl}}/sessions/session_1234567890_abcdefg/exec
Content-Type: application/json

{
  "command": "echo 'Hello from session'"
}

### 22. åœ¨ä¼šè¯ä¸­æ‰§è¡Œå¤šä¸ªå‘½ä»¤
POST {{baseUrl}}/sessions/session_1234567890_abcdefg/exec
Content-Type: application/json

{
  "command": "pwd && ls -la && echo 'Done'"
}

### 23. æ›´æ–°ä¼šè¯ç¯å¢ƒå˜é‡
POST {{baseUrl}}/sessions/session_1234567890_abcdefg/env
Content-Type: application/json

{
  "env": {
    "NEW_VAR": "new_value",
    "UPDATED_VAR": "updated_value"
  }
}

### 24. åˆ‡æ¢ä¼šè¯å·¥ä½œç›®å½•
POST {{baseUrl}}/sessions/session_1234567890_abcdefg/cd
Content-Type: application/json

{
  "path": "/tmp"
}

### 25. ç»ˆæ­¢ä¼šè¯
POST {{baseUrl}}/sessions/session_1234567890_abcdefg/terminate

###############################################################################
# éªŒè¯æµ‹è¯• Validation Tests
###############################################################################

### 26. æµ‹è¯•éªŒè¯ - ç©ºè·¯å¾„ï¼ˆåº”è¿”å› 400ï¼‰
POST {{baseUrl}}/files/write
Content-Type: application/json

{
  "path": "",
  "content": "test"
}

### 27. æµ‹è¯•éªŒè¯ - æ— æ•ˆç¼–ç ï¼ˆåº”è¿”å› 400ï¼‰
POST {{baseUrl}}/files/read
Content-Type: application/json

{
  "path": "/test.txt",
  "encoding": "invalid_encoding"
}

### 28. æµ‹è¯•éªŒè¯ - ç¼ºå°‘å¿…éœ€å­—æ®µï¼ˆåº”è¿”å› 400ï¼‰
POST {{baseUrl}}/process/exec
Content-Type: application/json

{
  "args": ["test"]
}

### 29. æµ‹è¯•éªŒè¯ - æ— æ•ˆçš„æ‰¹é‡ä¸Šä¼ ï¼ˆåº”è¿”å› 400ï¼‰
POST {{baseUrl}}/files/batch-upload
Content-Type: application/json

{
  "files": []
}

###############################################################################
# é”™è¯¯å¤„ç† Error Handling Tests
###############################################################################

### 30. è¯»å–ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼ˆåº”è¿”å› 404ï¼‰
POST {{baseUrl}}/files/read
Content-Type: application/json

{
  "path": "/non-existent-file.txt"
}

### 31. è®¿é—®ä¸å­˜åœ¨çš„ç«¯ç‚¹ï¼ˆåº”è¿”å› 404ï¼‰
GET {{baseUrl}}/non-existent-endpoint

### 32. æ— æ•ˆçš„ JSONï¼ˆåº”è¿”å› 400ï¼‰
POST {{baseUrl}}/files/write
Content-Type: application/json

{invalid json}

###############################################################################
# WebSocket è¿æ¥æµ‹è¯•
# æ³¨æ„ï¼šéœ€è¦ä½¿ç”¨ WebSocket å®¢æˆ·ç«¯å·¥å…·æµ‹è¯•
###############################################################################

### 33. WebSocket ç«¯ç‚¹æ£€æŸ¥
GET {{baseUrl}}/ws

###############################################################################
# å‹åŠ›æµ‹è¯• Stress Tests
###############################################################################

### 34. å¤§æ–‡ä»¶å†™å…¥æµ‹è¯•
POST {{baseUrl}}/files/write
Content-Type: application/json

{
  "path": "/large-file.txt",
  "content": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.",
  "encoding": "utf8"
}

### 35. å¹¶å‘è¿›ç¨‹æ‰§è¡Œæµ‹è¯•
POST {{baseUrl}}/process/exec
Content-Type: application/json

{
  "command": "sleep",
  "args": ["5"],
  "cwd": ""
}

